<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title></title>
<script src='$!assetslink.absolute("/resources/js/jquery-1.6.2.js")'></script>
<script src='$!assetslink.absolute("/resources/js/jquery.validate.min.js")'></script>
<script src='$!assetslink.absolute("/resources/js/jquery.shop.common.js")'></script>
<script src='$!assetslink.absolute("/resources/js/jquery.poshytip.min.js")'></script>
<link rel="stylesheet" href='$!assetslink.absolute("/resources/style/system/manage/$!{config.websiteCss}/template.css")' />
<script>
function ajax_update(id,fieldName,obj){
	var val=jQuery(obj).val();
	jQuery.ajax({type:'POST',
		url:'$!webPath/admin/store_ajax.htm',
			data:{"id":id,"fieldName":fieldName,"value":val},
				beforeSend:function(){
				},
				success:function(data){
					if(val==""){
						jQuery(obj).attr("src",'$!assetslink.absolute("/resources/style/system/manage/blue/images/")'+data+".png");
					}else{
						jQuery(obj).val(val);
				}
			}
		});
}
</script>
<script>
jQuery(document).ready(function(){
	populateForm();
});
function doCheckout(id){
	if(confirm('确定要操作吗?')){
	jQuery.ajax({type:'POST',url:'$!webPath/admin/store_del.htm',dataType:'json',data:{"mulitId":id},
		success:function(json){
			var flag=true;
			for(var key in json){
				if(json[key]==0){
					alert("店铺名称为:"+key+"的店铺删除失败，原因:该店铺还有商品，请确定店铺无商品后才能删除。");
					flag=false;
				}
			}
			if(flag){
				alert("删除成功");
			}
			var url="$!webPath/admin/store_list.htm";
			jQuery("#ListForm").attr("action",url);
			jQuery("#ListForm").submit();
		}
	});
	}
}

function doAllCheckout(){
	if(confirm('确定要操作吗?')){
		var mulitId="";
		jQuery(":checkbox:checked").each(function(){
			if(jQuery(this).val()!=""){
				mulitId=mulitId+","+jQuery(this).val();
			}
		});
		if(mulitId!=""){
			jQuery.ajax({type:'POST',url:'$!webPath/admin/store_del.htm',dataType:'json',data:{"mulitId":mulitId},
				success:function(json){
					var flag=true;
					for(var key in json){
						if(json[key]==0){
							alert("店铺名称为:"+key+"的店铺删除失败，原因:该店铺还有商品，请确定店铺无商品后才能删除。");
							flag=false;
						}
					}
					if(flag){
						alert("删除成功");
					}
					var url="$!webPath/admin/store_list.htm";
					jQuery("#ListForm").attr("action",url);
					jQuery("#ListForm").submit();
				}
			});
		}else{
			alert("至少选择一条数据记录");
		}
	}
}
</script>
</head>
<body>
<div class="cont">
	<h1 class="seth1">店铺管理</h1>
	<div class="settab"><span class="tab-one"></span> <span class="tabs"> <a href="$!webPath/admin/store_list.htm"  class="this">管理</a> | <a href="$!webPath/admin/store_add.htm">新增</a>|<a href="$!webPath/admin/store_gradelog_list.htm">升级申请</a> | <a href="$!webPath/admin/store_apply_list.htm">开店申请列表</a> | <a href="$!webPath/admin/store_audit_list.htm">审核列表</a> | <a href="$!webPath/admin/store_information_change_list.htm">店铺信息变更申请列表</a></span> <span class="tab-two"></span></div>
	<form action="$!webPath/admin/store_list.htm" method="post" name="queryForm" id="queryForm">
		<div class="allmem_search">
			<ul>
				<li>
					<span>店铺名称</span>
					<span class="allmen size4">
						<input name="store_name" type="text" id="store_name" />
					</span> 
					<span>店铺等级</span>
					<span class="allmen size4">
						<select name="grade.id" id="grade.id">
							<option value="">请选择...</option>
							#foreach($!grade in $grades)
							<option value="$!grade.id">$!grade.gradeName</option>
							#end
						</select>
					</span>
					<span>店铺状态</span>
					<span class="allmen size4">
						<select name="store_status" id="store_status">
							<option value="">请选择...</option>
							<option value="1">待审核</option>
							<option value="2">正常</option>
							<option value="3">违规关闭</option>
							<option value="4">过期自动关闭</option>
							<option value="-1">审核拒绝</option>
						</select>
					</span>
					<span class="btn_search">
						<input type="submit" value="搜索" style="cursor:pointer;"/>
					</span>
				</li>
			</ul>
		</div>
	</form>
	<form action="$!webPath/admin/store_list.htm" method="post" name="ListForm" id="ListForm">
		<div class="leveltable">
			<table width="100%" border="0" cellspacing="0" cellpadding="0" class="level_table">
				<tr style="background: #if($!config.websiteCss=='blue') #2A7AD2 #end
					#if($!config.websiteCss=='black')#333 #end; height:30px; color:#FFF">
					<td colspan="2">&nbsp;</td>
					<td width="20%" >店铺名称</td>
					<td width="15%">店主用户名 | 店主姓名</td>
					<td width="10%">所在地</td>
					<td width="10%">店铺类别</td>
					<td width="8%">店铺等级</td>
					<td width="8%">有效期至</td>
					<td width="6%">状态</td>
					<td width="6%">推荐</td>
					<td>操作</td>
				</tr>
				 #foreach($obj in $objs)
				<tr>
					<td colspan="2"><input type="checkbox" name="checkbox" id="checkbox" value="$!obj.id" /></td>
					<td>$!obj.store_name</td>
					<td>$!{obj.user.userName}|$!obj.store_ower</td>
					<td>[$!obj.area.parent.areaName]$!obj.area.areaName</td>
					<td>$!obj.sc.className</td>
					<td>$!obj.grade.gradeName</td>
						#if(!$!obj.validity)#set($validity="无限期")#else #set($validity=$!CommUtil.formatShortDate($!{obj.validity})) #end
					<td>$!validity</td>
						#if($!obj.store_status==1)
							#set($store_status="待审核")
						#elseif($!obj.store_status==2)
							#set($store_status="正常")
						#elseif($!obj.store_status==3)
							#set($store_status="关闭")
						#elseif($!obj.store_status==4)
							#set($store_status="过期自动关闭")
						#elseif($!obj.store_status==-1)
							#set($store_status="审核拒绝")
						#elseif($!obj.store_status==0)
							#set($store_status="尚未开通")
						#else
							#set($store_status="")
						#end
					<td>$!store_status</td>	
					<td><img src='$!assetslink.absolute("/resources/style/system/manage/blue/images/$!{obj.store_recommend}.png")' width="21" height="23" onclick="ajax_update('$!obj.id','store_recommend',this)"  style="cursor:pointer;" title="可编辑"/></td>
					<td class="ac9"><a href="$!webPath/admin/store_edit.htm?id=$!obj.id">修改</a> | <a href="javascript:void();" onclick="doCheckout($!obj.id)">删除</a>| <a href='$!frontlink.absolute("/store_$!{obj.id}.htm")' target="_blank">查看店铺</a></td>
				</tr>
				#end
				<tr>
						
					<td colspan="10">
						<span class="allevel">全部</span>
						<span class="shop_btn_del">
							<input name="" type="button" onclick="doAllCheckout()" value="删除" style="cursor:pointer;"/>
						</span>
					</td>
				</tr>
			</table>
		</div>
		<div class="fenye">
			<input type="hidden" name="mulitId" id="mulitId" />
			<input name="currentPage" type="hidden" id="currentPage" value="$!currentPage" />
			<span id="queryCondition">
			#foreach($sm in $!sms)
				<input name="$!sm.key" type="hidden" id="$!sm.key" value="$!sm.value" />
			#end
			</span>
			$!gotoPageFormHTML
		</div>
	</form>
</div>
</body>
</html>
