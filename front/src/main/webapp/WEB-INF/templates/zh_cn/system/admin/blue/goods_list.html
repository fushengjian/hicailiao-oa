<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title></title>
#macro ( genericTree $somelist )
#foreach ( $some in $somelist )
<option value="$!some.id" #if($!gc_name==$!some.className) selected="selected" #end>
#if($!some.level>0)
#foreach($count in [-1..$!some.level])&nbsp;#end #end $!some.className</option>
#genericTree($some.childs)
#end
#end
<!--[if IE]>
<style type="text/css">
.input{behavior: url($!assetslink.absolute("/resources/style/common/css/ie-css3.htc"));}
</style>
<![endif]-->
<link rel="stylesheet" href='$!assetslink.absolute("/resources/style/system/manage/$!{config.websiteCss}/template.css")' />
<script src='$!assetslink.absolute("/resources/js/jquery-1.6.2.js")'></script>
<script src='$!assetslink.absolute("/resources/js/jquery.shop.common.js")'></script>
<script src='$!assetslink.absolute("/resources/js/jquery.poshytip.min.js")'></script>
<script>
//
function ajax_update(id,fieldName,obj,value){
   var val;
   if(value==undefined){
	 val=jQuery(obj).val();
   }else val=value;
   jQuery.ajax({type:'POST',
	              url:'$!webPath/admin/goods_ajax.htm',
				  data:{"id":id,"fieldName":fieldName,"value":val},
				beforeSend:function(){

				},
			   success:function(data){
	             if(val==""){
				   jQuery(obj).attr("src",'$!assetslink.absolute("/resources/style/system/manage/blue/images/")'+data+".png");
				 }else{
				   jQuery(obj).val(val);
				 }
				 if(value!=undefined){
				   jQuery(obj.parentNode.parentNode).remove();
				 }
              }
	    });
}
// 下架
function salegoods(id) {
    if (confirm('确定下架该商品?')) {
        jQuery.ajax({
            type: 'POST', url: '$!webPath/admin/goods_sale.htm', dataType: 'json', data: {"mulitId": id},
            success: function (json) {
                if (json.saleflag) {
                    alert("商品下架成功!");
                    jQuery(':checkbox[value="' + id + '"]').parent().parent().remove();
                }
            }
        });
    }
}
// 下架所有选中商品
function salegoodsAllChecked() {
    var mulitId = "";
    jQuery(":checkbox:checked").each(function () {
        if (jQuery(this).val() != "") {
            mulitId = mulitId + "," + jQuery(this).val();
        }
    });
    if (mulitId != "") {
        if (confirm('确定下架该商品?')) {
            jQuery.ajax({
                type: 'POST', url: '$!webPath/admin/goods_sale.htm', dataType: 'json', data: {"mulitId": mulitId},
                success: function (json) {
                    if (json.saleflag) {
                        alert("商品下架成功!");
                    }
                    jQuery("#ListForm").submit();
                }
            });
        }
    }
}
</script>
<script>
    jQuery(document).ready(function() {
        populateForm();
    });
</script>
</head>
<body scroll="yes">
<div class="cont">
  <h1 class="seth1">商品管理</h1>
  <div class="settab">
	<span class="tab-one"></span> <span class="tabs">
	<a href="$!webPath/admin/goods_list.htm" class="this">所有商品</a> |<a href="$!webPath/admin/goods_outline.htm">违规下架商品</a></span>
	<span class="tab-two"></span>	</div>
	<form name="ListForm" id="ListForm" action="$!webPath/admin/goods_list.htm" method="post">
    <div class="allmem_search">
      <ul>
        <li> <span>商品名称</span> <span class="allmen size4">
          <input name="goods_name" type="text" id="goods_name" value="$!goods_name"/>
          </span> <span>品牌名称</span>
          <select name="brand_id" id="brand_id">
          <option value="">所有品牌</option>
          #foreach($gb in $gbs)
          <option value="$!gb.id" #if($!brand_name==$!gb.name) selected="selected" #end>$!gb.name</option>
          #end
          </select>
          <span>类别</span>
          <select name="gc_id" id="gc_id">
            <option value="">所有分类</option>
            #genericTree($!gcs)
          </select>
          <span>特别推荐</span>
          <select name="store_recommend" id="store_recommend">
            <option value="">是否特别推荐</option>
            <option value="true" #if($!store_recommend==true) selected="selected" #end>是</option>
            <option value="false" #if($!store_recommend==false) selected="selected" #end>否</option>
</select>
          <span class="btn_search">
          <input type="submit" value="搜索" style="cursor:pointer;"/>
        </span> </li>
      </ul>
    </div>
  <div class="operation">
    <h3>友情提示</h3>
    <ul>
      <li>上架商品，在商城前台所有访客均可查看，管理员和卖家都可以设置商品上架状态</li>
      <li>违规商品，管理员根据商城访客举报结合实际情况设定违规，违规商品前台不可显示，只能管理员能取消违规</li>
    </ul>
  </div>
    <div class="brandtable">
      <table width="100%" border="0" cellspacing="0" cellpadding="0" class="brand_table">
        <tr style="background: #if($!config.websiteCss=='blue') #2A7AD2 #end
      #if($!config.websiteCss=='black')#333 #end; height:30px; color:#FFF">
          <td width="3%">&nbsp;</td>
          <td width="25%">商品名称</td>
          <td width="10%">品牌</td>
          <td width="10%">分类名</td>
          <td width="10%">所在店铺</td>
          <td width="6%">商品状态</td>
          <td width="6%" align="center">特别推荐</td>
          <td width="6%" align="center">违规下架</td>
          <td width="6%" align="center">查看次数</td>
          <td  align="center">操作</td>
        </tr>
      #foreach($obj in $objs)
        <tr>
          <td align="center"><input name="checkbox" type="checkbox" id="checkbox" value="$!obj.id" /></td>
          <td>$!obj.goods_name</td>
          <td>$!obj.goods_brand.name</td>
          <td>$!obj.gc.className</td>
          <td>$!obj.goods_store.store_name</td>
          #if($!obj.goods_status==0)
           #set($goods_status="上架")
          #end
          #if($!obj.goods_status==1)
           #set($goods_status="仓库中")
          #end
          #if($!obj.goods_status==-1)
           #set($goods_status="已下架")
          #end
          #if($!obj.goods_status==-2)
           #set($goods_status="违规下架")
          #end
          <td>$!goods_status</td>
          <td align="center"><img onclick="ajax_update('$!obj.id','store_recommend',this)" src='$!assetslink.absolute("/resources/style/system/manage/blue/images/$!{obj.store_recommend}.png")' width="25" height="21" border="0" style="cursor:pointer;" title="特别推荐后在首页显示"/></td>
          <td align="center"><a href="$!webPath/admin/goods_sale_detail.htm?id=$!obj.id"><img src='$!assetslink.absolute("/resources/style/system/manage/blue/images/weig.jpg")' border="0" style="cursor:pointer;" title="下架"/></a></td>
          <td align="center">$!obj.goods_click</td>
          <td class="ac8" align="center"><a href='$!frontlink.absolute("/goods_$!{obj.id}.htm")' target="_blank">查看</a></td>
        </tr>
     #end
    </table>
	  <div class="fenye" align="right">
       <span id="queryCondition" style="display:none">
         #foreach($sm in $!sms)
         <input name="$!sm.key" id="$!sm.key" type="hidden" value="$!sm.value"/>
         #end
       </span>
	   <input name="currentPage" type="hidden" id="currentPage" value="$!currentPage" />
	   $!gotoPageFormHTML </div>
    </div>
  </form>
</div>
</body>
</html>
